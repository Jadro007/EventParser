(function(n){"use strict";var t=function(n,t){var i=this;this.el=n;this.cbs=t;this.points=[0,0];this.el.addEventListener("touchstart",function(n){i.start(n)});this.el.addEventListener("touchmove",function(n){n.preventDefault();i.move(n)})};t.prototype.start=function(n){n.targetTouches&&n.targetTouches.length===1&&(this.points[0]=n.targetTouches[0].offsetX?n.targetTouches[0].offsetX:n.targetTouches[0].layerX?n.targetTouches[0].layerX:n.targetTouches[0].pageX,this.points[1]=this.points[0])};t.prototype.diff=function(){return this.points[1]-this.points[0]};t.prototype.move=function(n){n.targetTouches&&n.targetTouches.length===1&&(this.points[1]=n.targetTouches[0].offsetX?n.targetTouches[0].offsetX:n.targetTouches[0].layerX?n.targetTouches[0].layerX:n.targetTouches[0].pageX,this.cbs.swiping(this.diff()),this.points[0]=this.points[1])};n.fn.swiper=function(i){if(typeof i.swiping!="function")throw'"swiping" callback must be defined.';this.each(function(){var r=n(this),u=r.data("swiper");u||r.data("swiper",u=new t(this,i))})}})(sxQuery),function(n,t){var l=null,i=null,r=null,w=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,h=null,u=0,a,e=[],c=0,f=null,s=null,o=null,y=!1,v=null,b=function(){t.get("/cmswebparts/kzn/common/addimage.aspx",null,function(n){var i={content:n,afterClose:nt,wrapCSS:"add-image-fancybox",padding:0};t.fancybox(i);k(t(".add-image-dialog"))})},k=function(n){i=n;i.find(".j-add-image-city").citySelect({onSelect:d});i.find(".j-add-image-browse").on("change",g);i.find(".j-add-image-name").val(h.name);i.find(".j-add-image-email").val(h.email);i.find("button").on("click",tt)},d=function(n){l=n},g=function(n){if(i.find(".j-add-image-file").val(t(n.target).val().replace("C:\\fakepath\\","")),this.files.length==1){var r=new FileReader;r.onload=function(n){i.find(".preview").show().find("img").attr("src",n.target.result)};r.readAsDataURL(this.files[0]);this.files[0].type!="image/jpeg"?i.find(".error").html("Vložte, prosím, soubor ve formátu jpeg."):i.find(".error").html("")}else i.find(".preview").hide()},nt=function(){l=null;i=null},tt=function(){var u,f,r,n;if(i.find(".j-add-image-browse")[0].files.length==0){i.find(".error").html("Vyberte fotografii");return}if(u=i.find(".j-add-image-title").val().trim(),!u||u.length==0){i.find(".error").html("Zadejte titulek fotografie");i.find(".j-add-image-title").focus();return}if(l==null){i.find(".error").html("Zvolte město");i.find(".j-add-image-city").focus();return}if(f=i.find(".j-add-image-name").val().trim(),!f||f.length==0){i.find(".error").html("Zadejte Vaše jméno");i.find(".j-add-image-name").focus();return}if(r=i.find(".j-add-image-email").val().trim(),!r||r.length==0){i.find(".error").html("Zadejte Váš e-mail");i.find(".j-add-image-email").focus();return}if(!w.test(r)){i.find(".error").html("Zadejte platný e-mail");i.find(".j-add-image-email").focus();return}i.find(".error").html("");n=new FormData;n.append("image",i.find(".j-add-image-browse")[0].files[0]);n.append("title",u);n.append("description",i.find(".j-add-image-desc").val());n.append("cityId",l.CityId);n.append("name",f);n.append("email",r);n.append("nodeId",h.nodeId);n.append("showOnWeb",i.find(".j-add-image-name-visible")[0].checked);t.ajax({url:"/Services/AddImage.ashx",type:"POST",data:n,async:!1,success:function(){alert("Děkujeme. Vaše fotografie byla vložena a čeká na schválení.");t.fancybox.close()},error:function(){alert("Omlouváme se, ale Vaši fotografii se nepodařilo vložit. Zkuste to prosím později.")},cache:!1,contentType:!1,processData:!1});console.log({})},p=function(n){u=u-n;u>0?u=0:u<a&&(u=a);r.find(".thumbs .in").stop().animate({left:u});r.find(".thumbs .prev").toggle(u!=0);r.find(".thumbs .next").toggle(u!=a)},it=function(n){if(!(Math.abs(n)<30)){var t,i=f.width();(t=n<0?c==e.length-1?0:c+1:c==0?e.length-1:c-1,y)||(y=!0,o[0].src=e[t].src,o.css({left:n>0?-i:i}),o.show(),o.animate({left:0},700),f.animate({left:n>0?i:-i},700,function(){f[0].src=o[0].src;f.css({left:0});o.hide();s.length>0&&s.text(e[t].indexText);v.find("span").removeClass("selected").eq(t).addClass("selected");c=t;y=!1}))}};this.init=function(){var n,c,i,l,u;if(r=t(".j-image-slider"),r.length!=0){h=JSON.parse(r.attr("data-model").replace(/'/g,'"'));r.find(".j-add-image").on("click",b);if(n=r.find(".thumbs"),c=n.find(".in"),f=r.find("#sliderImage"),s=r.find("#sliderImageIndex"),n.find(".in>span").each(function(){var n={src:t(this).attr("data-src")};return s.length>0&&(n.indexText=t(this).find(".index-icon").text()),e.push(n),e.length<=10}),h.mobile){if(e.length>1){for(o=t('<img id="sliderImageFake" src="" />').appendTo(f.parent()),v=t('<div class="points"><\/div>').appendTo(f.parent()),i=0;i<e.length;i++)i==0?v.append('<span class="selected"><\/span>'):v.append("<span><\/span>");u={swiping:function(n){it(n)}};f.swiper(u)}}else{if(n.width()<n[0].scrollWidth){l=n[0].scrollWidth;a=n.width()-l;u={swiping:function(n){p(-n)}};c.swiper(u);n.find(".prev").hide().on("click",function(){p(-150)});n.find(".next").show().on("click",function(){p(150)})}n.find("span[data-src]").on("click",function(n){var i=t(n.target).closest("span[data-src]");i.hasClass("selected")||(f[0].src=i.attr("data-src"),s.length>0&&s.text(i.find(".index-icon").text()),r.find(".thumbs span").removeClass("selected"),i.addClass("selected"))})}}};n.imageSlider=this}(window,sxQuery);sxQuery(function(){imageSlider.init()})