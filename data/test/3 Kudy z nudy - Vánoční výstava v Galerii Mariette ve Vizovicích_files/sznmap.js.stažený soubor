(function(n){var r=n(window),e=n(document),i={width:250,height:258},t={width:40,height:48},u={closeText:"Zavřít",prevText:"Předchozí",nextText:"Další",currentText:"Text",monthNames:["Leden","Únor","Březen","Duben","Květen","Červen","Červenec","Srpen","Září","Říjen","Listopad","Prosinec"],monthNamesShort:["Le","Ún","Bř","Du","Kv","Čn","Čc","Sr","Zá","Ří","Li","Pr"],dayNames:["Neděle","Pondělí","Úterý","Středa","Čtvrtek","Pátek","Sobota"],dayNamesShort:["Ne","Po","Út","St","Čt","Pá","So",],dayNamesMin:["Ne","Po","Út","St","Čt","Pá","So"],weekHeader:"Sm",dateFormat:"d.m.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},f;typeof SMap!="undefined"&&typeof SMap.Marker!="undefined"&&(SMap.Marker.selectedMarkerClass="seznam-map-selected-marker",SMap.Marker.selectedMarkerCoords=null,SMap.Marker.prototype._build=function(){if(typeof this._options.url=="string"){var t=SMap.Marker._image.cloneNode(!1);t.src=this._options.url;this._dom.container[SMap.LAYER_MARKER]=t}else this._dom.container[SMap.LAYER_MARKER]=this._options.url;this._options.title&&(this._dom.container[SMap.LAYER_MARKER].title=this._options.title);this._dom.active=this._dom.container[SMap.LAYER_MARKER];SMap.Marker.selectedMarkerCoords!=null&&this._coords.x==SMap.Marker.selectedMarkerCoords.x&&this._coords.y==SMap.Marker.selectedMarkerCoords.y&&n(this._dom.container[SMap.LAYER_MARKER]).addClass(SMap.Marker.selectedMarkerClass)},SMap.Marker.Feature.Card.prototype.decorate=function(n,t){return this.$super(n),t._marker=n,n._card=t,n.click=this.click,n.getContainer()[SMap.LAYER_MARKER].style.cursor="pointer",n},SMap.Marker.Feature.Card.prototype.click=function(t,i){this.$super(t,i);this.getMap().addCard(this._card,this._coords);n("."+SMap.Marker.selectedMarkerClass).removeClass(SMap.Marker.selectedMarkerClass);n(this._card._marker.getContainer()[SMap.LAYER_MARKER]).addClass(SMap.Marker.selectedMarkerClass);SMap.Marker.selectedMarkerCoords=this._coords},SMap.Card.prototype._computePosition=function(i){var r,o;typeof SMap.Marker.markerSize=="undefined"&&(r=n(this._marker.getContainer()[SMap.LAYER_MARKER]),SMap.Marker.markerSize={width:r.outerWidth(),height:r.outerHeight()});var f=this._marker.getAnchor(),e=this.getMap(),u=i.toPixel(e).minus(e.getOffset());return u.x-=(this._size[0]-SMap.Marker.markerSize.width)/2+f.left,o=t.height,u.y-=SMap.Marker.markerSize.height-f.top+o,u},f=function(f,e){var bt={latitude:50.08,longitude:14.41,zoom:10,documentId:0,marker:"",title:""},s=this,b=n("body"),d=0,c=n(f),kt=c.parent(),dt=c.find(".j-map"),rt=c.find(".j-filter"),g=c.find(".j-toggle"),nt=c.find(".j-overlay"),v=!1,o=null,p=null,l=null,y=null,k=null,w=null,tt,h={types:[],suitableFor:[],rightTop:"",leftBottom:"",priceRange:[0,1e3],dateFrom:"",dateTo:""},gt={0:"Světadíly",3:"Státy",6:"Kraje",9:"Města",12:"Obce",15:"Ulice",18:"Domy",19:"Ptačí pohled"},ni={titles:["Přiblížit","Oddálit"]};s.init=function(){if(s.settings=n.extend({},bt,e),a()&&!fi()){c.hide();return}console.DEBUG=1;ri();a()||ii();w=ti();g.find("a").on("click",s.toggle);w.on("mousedown",s.toggle);c.on("mousedown",function(n){n.stopPropagation()});nt.on("click",s.toggle);r.on("resize",at);r.on("click",ci)};s.toggle=function(n){if(pt(n),v){ft(!0);ut(!1);c.appendTo(kt);c.removeClass("toggled");w.hide();g.find("a").html("Zobrazit mapu");nt.show();try{a()||l.disable()}catch(t){console.log(t)}wt(!1);o.removeCard();v=!1}else{ft(!1);ut(!0);c.appendTo(w);c.addClass("toggled");w.show();g.find("a").html("Skrýt mapu");nt.hide();wt(!0);v=!0;try{a()||l.enable()}catch(t){console.log(t)}}at()};var ut=function(t){t=t||!1;t?(d=n(window).scrollTop(),b.css("top","-"+d+"px"),b.addClass("fixed")):(b.removeClass("fixed"),b.css("top",""),n(window).scrollTop(d))},ft=function(t){var r=n("meta[name=viewport]"),i=r.attr("content").toLowerCase();i.indexOf("user-scalable=")>-1&&(i.indexOf("user-scalable=yes")>-1?i=i.replace("user-scalable=yes","user-scalable="+(t?"yes":"no")):i.indexOf("user-scalable=1")>-1?i=i.replace("user-scalable=1","user-scalable="+(t?"1":"0")):i.indexOf("user-scalable=no")>-1?i=i.replace("user-scalable=no","user-scalable="+(t?"yes":"no")):i.indexOf("user-scalable=0")>-1&&(i=i.replace("user-scalable=0","user-scalable="+(t?"1":"0"))));r.attr("content",i);t?n("html").css({"touch-action":"",height:"","overscroll-behavior":""}):n("html").css({"touch-action":"pan-x pan-y",height:"100%","overscroll-behavior":"contain"})},ti=function(){return k==null&&(k=n('<div class="szn-map-toggled-wrap"><\/div>'),k.appendTo(n("body"))),k},ii=function(){n.get("/CMSWebParts/KZN/Common/SeznamMapFilter.aspx",null,function(t){var i=n(t);i.find(".tab").each(function(t){var r=n(this),i,f;r.on("click",function(t){pt(t);n(this).hasClass("remove-dates")&&(n(this).parent().find(".date-from").datepicker("setDate",null),n(this).parent().find(".date-to").datepicker("setDate",null),h.dateFrom="",h.dateTo="",it(n(this).closest("li")));var i=n(t.target).closest("li");i.hasClass("toggled")?i.removeClass("toggled"):(rt.find("li").removeClass("toggled"),i.addClass("toggled"))});i=r.closest("li");switch(t){case 0:i.find(".types-list input").on("change",function(n){vt(n,h.types)});break;case 1:i.find(".types-list input").on("change",function(n){vt(n,h.suitableFor)});break;case 2:i.find(".slider").slider({range:!0,min:0,max:1e3,values:[0,1e3],slide:function(n,t){var f=t.values[0],e=t.values[1],u;h.priceRange[0]=f;h.priceRange[1]=e;i.find(".price-from").text(f+" Kč");i.find(".price-to").text(e+" Kč");u="";f>0&&(u="od "+f+" Kč");e<1e3&&(u+=" do "+e+" Kč");u=u.trim();u==""&&(u="nezáleží");r.find("span").html(u)},stop:function(){ot()}});break;case 3:f={onSelect:function(n){h.dateFrom=n;var t=i.find(".date-from").datepicker("getDate"),u=i.find(".date-to").datepicker("getDate");u!=null&&t>u&&(i.find(".date-to").datepicker("setDate",null),h.dateTo="");i.find(".date-to").datepicker("option","minDate",t);it(r)}};i.find(".date-from").datepicker(n.extend(f,u));f={onSelect:function(n){h.dateTo=n;it(r)}};i.find(".date-to").datepicker(n.extend(f,u))}});rt.append(i)})},ri=function(){if(s.settings.center=SMap.Coords.fromWGS84(s.settings.longitude,s.settings.latitude),o=new SMap(dt[0],s.settings.center,s.settings.zoom),o.addDefaultLayer(SMap.DEF_BASE).enable(),l=new SMap.Layer.Marker,o.addLayer(l),l.enable(),p=new SMap.Layer.Marker,o.addLayer(p),p.enable(),o.getSignals().addListener(window,"map-redraw",et),o.getSignals().addListener(window,"marker-click",hi),o.getSignals().addListener(window,"port-sync",oi),s.settings.documentId>0){var u={title:s.settings.title,url:s.settings.marker,anchor:{left:t.width/2,top:t.height}},r=new SMap.Marker(s.settings.center,s.settings.documentId,u),n=new SMap.Card;n.setSize(i.width,i.height);n.getBody().innerHTML='<div id="text_id_'+s.settings.documentId+'" class="szn-card-body"><\/div>';r.decorate(SMap.Marker.Feature.Card,n);p.addMarker(r)}a()&&(ht(),ct())},et=function(){tt&&clearTimeout(tt);tt=setTimeout(ot,500)},ui=function(t,i,r){v&&(r=r||!1,y!==null&&y.abort(),y=n.ajax({type:"GET",url:"/Services/SeznamMapDetail.ashx?documentID="+i,contentType:"application/json; charset=utf-8",dataType:"json",success:function(u){var f=u,h=o.getCard(),e=n("#text_id_"+i),s;e.empty();n('<a href="'+f.url+'" class="img" title="'+f.name+'"><\/a>').appendTo(e).append('<img src="'+f.image+'" />').append("<h3>"+f.name+"<\/h3>");e.append('<div class="add-to-trip"><a href="'+f.url+'">Detail<\/a><\/div>');f=t.getCoords();f&&e.append('<div class="seznam-map-link"><a target="_blank" href="https://www.mapy.cz/?x='+f.x+"&y="+f.y+"&source=coor&id="+f.x+"%2C"+f.y+'">Navigovat pomocí mapy.cz<\/a><\/div>');r&&(s=t.getCoords(),o.setCenter(s,!0))}}))},ot=function(){if(a()){ht();return}if(v){y!==null&&y.abort();var t=o.getSize(),i=Math.round(t.x/2),r=Math.round(t.y/2),e=new SMap.Pixel(-1*i,r),s=new SMap.Pixel(i,-1*r),u=e.toCoords(o).toWGS84(),f=s.toCoords(o).toWGS84();h.rightTop=f[1]+","+f[0];h.leftBottom=u[1]+","+u[0];y=n.ajax({type:"POST",url:"/Services/SeznamMap.ashx",data:JSON.stringify({filter:h}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){yt(n)}})}},a=function(){return n(".news-releated-container").length>0},fi=function(){var n=st();return a()&&(n.Documents.length>0||s.settings.documentId)},st=function(){var t={Documents:[]};return a()&&n(".news-releated-document:not(.hidden)").each(function(i,r){var u=n(r),s=parseInt(u.data("docid")),h=u.data("classname"),c=parseInt(u.data("typeid")),f=parseFloat(u.data("lat")),e=parseFloat(u.data("lon")),l=n(".info > h2 > a",u).attr("title"),o;f!==0&&e!==0&&(o={documentId:s,marker:si(h,c),title:l,coordinate:{Longitude:e,Latitude:f}},t.Documents.push(o))}),t},ht=function(){var n=st();yt(n)},ei=function(n,t,i){i=i||!1;t=t||0;try{var r=o.computeCenterZoom(n,!1),u=r[0],f=t||r[1],e=o.getCenter(),h=o.getZoom()||s.settings.zoom;e.equals(u)&&h===f||o.setCenterZoom(u,f,i)}catch(c){console.log(c)}},ct=function(n){var u,t;n=n||!1;var f=p.getMarkers(),i=!v&&!a()?[]:l.getMarkers(),r=f.concat(i);r&&(u=r.map(n=>n.getCoords()),t=0,i.length===0&&(t=s.settings.zoom),ei(u,t,n))},oi=function(){ct()},si=function(n,t){n=n.toLowerCase();var i="";switch(n){case"kzn.event":i="/css/images/sznmap/marker-evt.png";break;case"kzn.activity":i="/css/images/sznmap/marker-"+(t>0?t:"misc")+".png";break;case"kzn.touristcentrum":i="/css/images/sznmap/marker-tic.png";break;case"kzn.news":i="/css/images/sznmap/marker-"+(t>0?t:"misc")+".png";break;case"kzn.czechbestof":i="/css/images/sznmap/marker_cn.png";break;default:i="/css/images/sznmap/marker-misc.png"}return i},it=function(n){var t="";h.dateFrom.length>0&&(t="od "+h.dateFrom);h.dateTo.length>0&&(t+=" do "+h.dateTo);t=t.trim();t==""&&(t="nezáleží");n.find("span").html(t);lt()},lt=function(){et()},hi=function(n){var t=n.target,i=t.getId();ui(t,i,!0)},at=function(){try{o.syncPort()}catch(n){console.log(n)}},vt=function(t,i){var u=n(t.target),s=u[0].checked,h=u.val(),f=u.closest("li"),c=f.find(".tab"),r="",e=f.find('.types-list input[value="0"]'),o;if(h==0)if(s)f.find('.types-list input[value!="0"]').each(function(){this.checked=!1;n(this).parent().removeClass("checked")}),i.splice(0,i.length),r="vše";else{u[0].checked=!0;return}else u.parent().toggleClass("checked",s),s?(i.push(h),e[0].checked=!1,e.parent().removeClass("checked")):(i.splice(i.indexOf(h),1),i.length==0&&(e[0].checked=!0,e.parent().addClass("checked"))),i.length==0?r="vše":(o=0,f.find('.types-list input[value!="0"]').each(function(){if(!this.checked)return!0;r==""?r=n(this).parent().find("span").text():o++}),o>0&&(r+=" +"+o));c.find("span").html(r);lt()},ci=function(t){var i=n(t.target),r=i.closest(".j-filter");r.length==0&&n(".j-filter li").removeClass("toggled")},yt=function(r){l.removeAll();l.clear();n.each(r.Documents,function(n,r){if(r.documentId===s.settings.documentId&&!a())return!0;var e={url:r.marker,title:r.title,anchor:{left:t.width/2,top:t.height}},o=SMap.Coords.fromWGS84(r.coordinate.Longitude,r.coordinate.Latitude),f=new SMap.Marker(o,r.documentId,e),u=new SMap.Card;u.setSize(i.width,i.height);u.getBody().innerHTML='<div id="text_id_'+r.documentId+'" class="szn-card-body"><\/div>';f.decorate(SMap.Marker.Feature.Card,u);l.addMarker(f)});l.redraw()},pt=function(n){n!=undefined&&(window.event?window.event.returnValue=!1:n.preventDefault?n.preventDefault():n.returnValue=!1)},wt=function(n){var t,r,i;if(n)o.addControl(new SMap.Control.Zoom(gt,ni)),o.addControl(new SMap.Control.Mouse(SMap.MOUSE_PAN|SMap.MOUSE_WHEEL|SMap.MOUSE_ZOOM,{})),t=new SMap.Control.Layer,t.addDefaultLayer(SMap.DEF_BASE),t.addDefaultLayer(SMap.DEF_SMART_OPHOTO),t.addDefaultLayer(SMap.DEF_TURIST),o.addDefaultLayer(SMap.DEF_SMART_OPHOTO),o.addDefaultLayer(SMap.DEF_TURIST),o.addDefaultLayer(SMap.DEF_TRAIL),o.addControl(t),o.getLayer(SMap.DEF_TURIST).setTrail(!0);else for(r=o.getControls(),i=r.length+1;i>=2;i--)o.removeControl(r[i])};s.init()},n.fn.sznMap=function(t){var r=n(this),i=r.data("sznMap");return undefined==i&&(i=new f(this,t),n(this).data("sznMap",i)),i})})(sxQuery)