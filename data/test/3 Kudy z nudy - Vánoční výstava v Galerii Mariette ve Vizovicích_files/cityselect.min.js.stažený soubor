var citySelectAdmin=function(){};(function(n){var t=n(window),i=n(document),r=function(r,u){var w={type:"",showRegion:!0,showArea:!0,onSelect:null},f=this,e=n(r),c=null,s=null,o=null,l=3,h=[];f.init=function(){f.settings=n.extend({},w,u);g();l=1+(f.settings.showArea?1:0)+(f.settings.showRegion?1:0);e.off("input");e.on("input",b);e.off("keydown");e.on("keydown",k)};var b=function(){var r=-1,t,i;n.isNumeric(n(this).attr("data-region-id"))&&(r=n(this).attr("data-region-id"));t=-1;n.isNumeric(n(this).attr("data-area-id"))&&(t=n(this).attr("data-area-id"));i=!1;n(this).attr("data-loadurl")=="true"&&(i=!0);d(n(this).val(),r,t,i)},k=function(t){if(t.keyCode==13&&(preventEventDefault(t),h&&h.length>0)){var i=h[0];if(e.val(i.CityName),o.hide(),n.isFunction(f.settings.onSelect))f.settings.onSelect(i)}},d=function(t,i,r,u){var s,e,o;(c&&c.abort(),t.length!=0)&&(s={Text:t,Type:f.settings.type},e=t,i>0&&(e=e+"&region="+i),r>0&&(e=e+"&area="+r),u&&(e=e+"&loadurl=true"),o="/Services/City.ashx?text="+e,f.settings.type=="tic"&&(o="/Services/TouristCity.ashx?text="+t),c=n.ajax({type:"GET",url:o,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){var t=n.d;it(s,t)}}))},g=function(){o=n('<div class="city-select-results"><table><thead><tr><th>Město<\/th>'+(f.settings.showArea?"<th>Oblast<\/th>":"")+(f.settings.showRegion?"<th>Region<\/th>":"")+"<\/tr><\/thead><tbody><\/tbody><\/table><\/div>");o.css({"min-width":e.outerWidth()});s=o.find("tbody")},nt=function(){o.hide();t.off("resize",y);t.off("click",v);i.off("keydown",a)},a=function(){},tt=function(t){var i=h[t.index()];if(e.val(i.CityName),n.isFunction(f.settings.onSelect))f.settings.onSelect(i)},v=function(t){var i=n(t.target),u=i.closest("city-select-results"),r;if((!(u.length>0)||u[0]!==o[0])&&i[0]!=e[0]){if(!n(i[0]).hasClass("city-option")&&h&&h.length>0&&(r=h[0],e.val(r.CityName),o.hide(),n.isFunction(f.settings.onSelect)))f.settings.onSelect(r);nt()}},y=function(){p()},p=function(){o.appendTo(n("body"));var t=e.offset(),i={left:t.left,top:t.top+e.height()};o.css(i);o.css({"max-width":"calc(100% - "+t.left+"px)"})},it=function(r,u){if(h=u,p(),s.empty(),u.length==0){var e=n('<tr><td colspan="'+l+'">Žádná města nebyla nalezena<\/td><\/tr>');e.appendTo(s);return}n.each(u,function(t,i){var r=n('<tr class="city-option"><td class="city-option">'+i.CityName+"<\/td>"+(f.settings.showArea?'<td class="city-option">'+i.AreaName+"<\/td>":"")+(f.settings.showRegion?'<td class="city-option">'+i.RegionName+"<\/td>":"")+"<\/tr>"),u;r.on("click",function(t){tt(n(t.target).closest("tr"))});u=s.children("tr:first");u.toggleClass("hovered");r.appendTo(s)});s.closest(".city-select-results").mouseleave(function(t){var r=n(t.target),i;r.is(".city-select-results")&&(i=s.children("tr:first"),i.addClass("hovered"))});s.closest(".city-select-results").mouseover(function(t){var r=n(t.target),i;r.is(".city-select-results")&&(i=s.children("tr:first"),i.removeClass("hovered"))});t.on("resize",y);t.on("click",v);i.on("keydown",a);o.show()};f.init()};citySelectAdmin=r;n.fn.citySelect=function(t){return this.each(function(){if(undefined==n(this).data("citySelect")){var i=new r(this,t);n(this).data("citySelect",i)}})}})(sxQuery)